<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Random Mock Interview - PySpark</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
body {margin:0; font-family:'Roboto',sans-serif; background:#1f1c2c; color:#fff;}
.container {max-width:800px; margin:20px auto; padding:30px; border-radius:16px; background:#2c2a3a; box-shadow:0 10px 30px rgba(0,0,0,0.5);}
h1,h2,h3{text-align:center;}
.user-info{text-align:center; margin-bottom:20px; font-size:0.9em; color:#dcdcdc;}
.user-info span{color:#ff6b6b; font-weight:500;}
.timer{text-align:right; font-weight:700; color:#ff4d4d; margin-bottom:20px;}
.question{margin-bottom:25px;}
.question label{display:block; font-weight:500; margin-bottom:10px; font-size:1.1em; color:#fff;}
.question textarea{width:100%; min-height:100px; padding:12px; border-radius:10px; border:none; resize:vertical; font-size:1em; background:#3a384c; color:#fff;}
.btn{padding:12px 24px; margin:10px; font-size:1em; font-weight:600; border:none; border-radius:8px; cursor:pointer; transition:0.3s ease;}
.btn-primary{background:#ff6b6b;color:#fff;}
.btn-primary:hover{background:#ff4d4d;}
.btn-secondary{background:#5bc0de;color:#fff;}
.btn-secondary:hover{background:#31b0d5;}
</style>
</head>
<body>
<div class="container" id="app"></div>

<script>
let examId, userName, userEmail;
let questions = [];
let selectedQuestions = [];
let currentIndex = 0;
let answers = {};
let timerInterval;

function renderRegister(){
    document.getElementById("app").innerHTML = `
        <h1>Welcome to Mock Interview</h1>
        <form id="registerForm">
            <label>Name:</label>
            <input type="text" id="name" required style="width:100%;padding:10px;border-radius:8px;border:none;margin-bottom:10px;">
            <label>Email:</label>
            <input type="email" id="email" required style="width:100%;padding:10px;border-radius:8px;border:none;margin-bottom:20px;">
            <button type="submit" class="btn btn-primary">Start Exam</button>
        </form>
    `;
    document.getElementById("registerForm").addEventListener('submit', startExam);
}

async function loadQuestionsJSON(){
    const response = await fetch('questions.json');
    questions = await response.json();
}

async function startExam(e){
    e.preventDefault();
    userName = document.getElementById('name').value;
    userEmail = document.getElementById('email').value;
    examId = 'EXAM-' + Date.now();
    await loadQuestionsJSON();
    selectedQuestions = questions.sort(()=>0.5-Math.random()).slice(0,10);
    currentIndex = 0;
    answers = {};
    renderQuestion();
    startTimer(10*60);
}

function renderQuestion(){
    const q = selectedQuestions[currentIndex];
    document.getElementById("app").innerHTML = `
        <h1>Random Mock Interview - PySpark</h1>
        <div class="user-info">
            Name: <span>${userName}</span> | Email: <span>${userEmail}</span> | Exam ID: <span>${examId}</span>
        </div>
        <div class="timer" id="timer">Time left: 10:00</div>
        <div class="question">
            <label>Q${currentIndex+1}/${selectedQuestions.length}. ${q.question}</label>
            <textarea id="answerBox">${answers[currentIndex]||''}</textarea>
        </div>
        <div style="text-align:center;">
            <button class="btn btn-secondary" id="backBtn" ${currentIndex===0?'style="display:none"':''}>Back</button>
            ${currentIndex<selectedQuestions.length-1?`<button class="btn btn-secondary" id="nextBtn">Next</button>`:`<button class="btn btn-primary" id="submitBtn">Submit</button>`}
        </div>
    `;
    if(currentIndex < selectedQuestions.length - 1){
        document.getElementById('nextBtn').addEventListener('click', () => {
            answers[currentIndex] = document.getElementById('answerBox').value;
            currentIndex++;
            renderQuestion();
        });
    } else {
        document.getElementById('submitBtn').addEventListener('click', submitExam);
    }
    if(currentIndex>0){
        document.getElementById('backBtn').addEventListener('click', ()=>{
            answers[currentIndex] = document.getElementById('answerBox').value;
            currentIndex--;
            renderQuestion();
        });
    }
}

function startTimer(duration){
    let time=duration;
    clearInterval(timerInterval);
    timerInterval = setInterval(()=>{
        let min=Math.floor(time/60).toString().padStart(2,'0');
        let sec=(time%60).toString().padStart(2,'0');
        const timerEl = document.getElementById('timer');
        if(timerEl) timerEl.textContent = `Time left: ${min}:${sec}`;
        if(time<=0){clearInterval(timerInterval); submitExam();}
        time--;
    },1000);
}

async function submitExam(){
    answers[currentIndex] = document.getElementById('answerBox').value;
    clearInterval(timerInterval);

    const record = { examId, userName, userEmail, answers, timestamp:new Date().toISOString() };

    try {
        const res = await fetch("/api/submitExam", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify(record)
        });
        const data = await res.json();
        console.log("Saved to GitHub:", data);
    } catch(err){
        console.error("Error:", err);
    }

    document.getElementById("app").innerHTML = `<h2>Thank you ${userName}! Your exam is submitted.</h2>`;
}

renderRegister();
</script>
</body>
</html>
